<?php
/**
 * User: xrh
 * Date: 15-2-9 下午4:29
 * Description:
 */

include_once dirname(__FILE__) . "/SignaturePad.php";

$path = '{"timestamp":"[1423475106613,1423475106614,1423475106687,1423475106702,1423475106718,1423475106734,1423475106764,1423475106873,1423475106873,1423475106898,1423475106915,1423475106932,1423475106948,1423475106964,1423475106989,1423475107098,1423475107098,1423475107161,1423475107178,1423475107196,1423475107211,1423475107227,1423475107244,1423475107260,1423475107276,1423475107293,1423475107309,1423475107325,1423475107342,1423475107371,1423475107709,1423475107710,1423475107752,1423475107769,1423475107785,1423475107802,1423475107818,1423475107834,1423475107850,1423475107867,1423475107884,1423475107900,1423475107916,1423475107932,1423475107949,1423475107966,1423475107982,1423475107998,1423475108015,1423475108031,1423475108048,1423475108064,1423475108086,1423475108233,1423475108234,1423475108277,1423475108294,1423475108311,1423475108326,1423475108343,1423475108359,1423475108375,1423475108392,1423475108409,1423475108425,1423475108442,1423475108458,1423475108475,1423475108495,1423475108630,1423475108630,1423475108671,1423475108688,1423475108704,1423475108721,1423475108738,1423475108753,1423475108770,1423475108786,1423475108815,1423475108938,1423475108938,1423475108982,1423475108999,1423475109016,1423475109032,1423475109047,1423475109117,1423475109117,1423475109179,1423475109196,1423475109227,1423475111835,1423475111836,1423475111888,1423475111905,1423475111921,1423475111938,1423475111955,1423475111971,1423475111987,1423475112016,1423475112084,1423475112085,1423475112134,1423475112152,1423475112169,1423475112195,1423475112285,1423475112286,1423475112331,1423475112348,1423475112365,1423475112382,1423475112398,1423475112415,1423475112431,1423475112447,1423475112464,1423475112480,1423475112496,1423475112512,1423475112530,1423475112890,1423475112890,1423475112938,1423475112957,1423475112972,1423475113000,1423475113068,1423475113069,1423475113119,1423475113136,1423475113153,1423475113169,1423475113186,1423475113202,1423475113219,1423475113235,1423475113251,1423475113267,1423475113284,1423475113432,1423475113434,1423475113464,1423475113481,1423475113498,1423475113513,1423475113529,1423475113546,1423475113563,1423475113580,1423475113597,1423475113613,1423475113629,1423475113657,1423475113825,1423475113826,1423475113858,1423475113875,1423475113892,1423475113908,1423475113924,1423475113941,1423475113957,1423475113973,1423475114017,1423475114125,1423475114126,1423475114186,1423475114204,1423475114220,1423475114236,1423475114253,1423475114280,1423475114349,1423475114349,1423475114415,1423475114430,1423475115393,1423475115395,1423475115433,1423475115451,1423475115467,1423475115484,1423475115499,1423475115515,1423475115543,1423475115642,1423475115642,1423475115695,1423475115713,1423475115729,1423475115746,1423475115766,1423475115907,1423475115907,1423475115958,1423475115975,1423475115992,1423475116008,1423475116025,1423475116041,1423475116058,1423475116074,1423475116090,1423475116106,1423475116122,1423475116150,1423475116551,1423475116551,1423475116615,1423475116632,1423475116648,1423475116664,1423475116681,1423475116697,1423475116714,1423475116743,1423475116863,1423475116863,1423475116894,1423475116910,1423475116928,1423475116944,1423475116960,1423475116977,1423475116993,1423475117009,1423475117026,1423475117042,1423475117065,1423475117221,1423475117222,1423475117238,1423475117256,1423475117272,1423475117292,1423475117380,1423475117381,1423475117419,1423475117436,1423475117454,1423475117469,1423475117485,1423475117501,1423475117518,1423475117551,1423475117669,1423475117669,1423475117714,1423475117732,1423475117748,1423475117765,1423475117782,1423475117797,1423475117813,1423475117830,1423475117847,1423475117983,1423475117984,1423475118042,1423475118060,1423475118076,1423475118093,1423475118109,1423475118125,1423475118152,1423475118183,1423475118184,1423475118272,1423475118290,1423475118306,1423475118321,1423475120665,1423475120666,1423475120702,1423475120719,1423475120735,1423475120752,1423475120769,1423475120784,1423475120801,1423475120817,1423475120834,1423475120850,1423475120867,1423475120883,1423475120900,1423475120916,1423475120933,1423475120949,1423475120965,1423475120982,1423475120998,1423475121014,1423475121031,1423475121047,1423475121063,1423475121080,1423475121096,1423475121112,1423475121129,1423475121146,1423475121162,1423475121179,1423475121195,1423475121211,1423475121228,1423475121244,1423475121293,1423475121310,1423475121333,1423475122109,1423475122110,1423475122163,1423475122180,1423475122198,1423475122213,1423475122229,1423475122259,1423475122375,1423475122376,1423475122425,1423475122442,1423475122459,1423475122475,1423475122492,1423475122508,1423475122524,1423475122650,1423475122651,1423475122704,1423475122721,1423475122738,1423475122754,1423475122771,1423475122787,1423475122804,1423475122819,1423475122836,1423475122852,1423475122868,1423475122885,1423475122901,1423475122915,1423475123295,1423475123295,1423475123328,1423475123345,1423475123362,1423475123378,1423475123394,1423475123410,1423475123426,1423475123443,1423475123459,1423475123476,1423475123495,1423475123510,1423475123525,1423475123542,1423475123558,1423475123575,1423475123591,1423475123608,1423475123624,1423475123640,1423475123656,1423475123673,1423475123689,1423475123705,1423475123726,1423475123929,1423475123930,1423475123951,1423475123968,1423475123985,1423475124001,1423475124018,1423475124034,1423475124050,1423475124066,1423475124083,1423475124100,1423475124117,1423475124133,1423475124149,1423475124165,1423475124181,1423475124206,1423475124319,1423475124319,1423475124346,1423475124362,1423475124379,1423475124396,1423475124412,1423475124428,1423475124445,1423475124461,1423475124477,1423475124494,1423475124510,1423475124526,1423475124542,1423475124569,1423475124693,1423475124694,1423475124755,1423475124773,1423475124790,1423475124805,1423475124833,1423475124923,1423475124924,1423475124986,1423475125002,1423475125032,1423475126059,1423475126060,1423475126102,1423475126119,1423475126136,1423475126152,1423475126169,1423475126185,1423475126201,1423475126217,1423475126296,1423475126298,1423475126364,1423475126382,1423475126398,1423475126421,1423475126519,1423475126520,1423475126595,1423475126612,1423475126628,1423475126645,1423475126661,1423475126678,1423475126693,1423475126709,1423475126726,1423475126742,1423475126759,1423475126775,1423475126791,1423475127406,1423475127407,1423475127431,1423475127449,1423475127465,1423475127482,1423475127498,1423475127525,1423475127622,1423475127623,1423475127661,1423475127679,1423475127695,1423475127711,1423475127728,1423475127744,1423475127761,1423475127777,1423475127794,1423475127810,1423475127830,1423475128056,1423475128057,1423475128088,1423475128105,1423475128136,1423475128177,1423475128178,1423475128219,1423475128237,1423475128253,1423475128269,1423475128293,1423475128449,1423475128449,1423475128531,1423475128548,1423475128564,1423475128581,1423475128598,1423475128614,1423475128646,1423475128663,1423475128679,1423475128695,1423475128711,1423475128728,1423475128756,1423475128903,1423475128904,1423475128958,1423475128975,1423475128991,1423475129007,1423475129032,1423475129084,1423475129085,1423475129171,1423475129199,1423475130364,1423475130366,1423475130402,1423475130419,1423475130436,1423475130452,1423475130469,1423475130485,1423475130501,1423475130529,1423475130618,1423475130619,1423475130681,1423475130699,1423475130715,1423475130735,1423475130842,1423475130843,1423475130960,1423475130978,1423475130994,1423475131010,1423475131026,1423475131043,1423475131059,1423475131075,1423475131091,1423475131128,1423475131620,1423475131621,1423475131665,1423475131683,1423475131699,1423475131716,1423475131738,1423475131816,1423475131817,1423475131862,1423475131880,1423475131896,1423475131913,1423475131929,1423475131945,1423475131962,1423475131978,1423475131994,1423475132011,1423475132048,1423475132214,1423475132214,1423475132256,1423475132274,1423475132290,1423475132306,1423475132322,1423475132339,1423475132355,1423475132372,1423475132388,1423475132405,1423475132421,1423475132437,1423475132455,1423475132554,1423475132554,1423475132618,1423475132635,1423475132652,1423475132668,1423475132684,1423475132701,1423475132717,1423475132734,1423475132750,1423475132766,1423475132798,1423475132823,1423475132970,1423475132971,1423475133028,1423475133045,1423475133062,1423475133078,1423475133094,1423475133119,1423475133189,1423475133190,1423475133258,1423475133275,1423475133292,1423475133313,1423475134050,1423475134051,1423475134095,1423475134112,1423475134129,1423475134145,1423475134162,1423475134178,1423475134194,1423475134221,1423475134261,1423475134262,1423475134341,1423475134359,1423475134388,1423475134524,1423475134525,1423475134587,1423475134604,1423475134622,1423475134638,1423475134655,1423475134671,1423475134687,1423475134703,1423475134720,1423475134736,1423475134753,1423475134769,1423475134797,1423475135459,1423475135460,1423475135490,1423475135508,1423475135525,1423475135554,1423475135642,1423475135643,1423475135687,1423475135705,1423475135720,1423475135737,1423475135754,1423475135770,1423475135787,1423475135803,1423475135819,1423475135836,1423475135882,1423475136052,1423475136053,1423475136081,1423475136098,1423475136115,1423475136131,1423475136148,1423475136164,1423475136180,1423475136197,1423475136213,1423475136230,1423475136246,1423475136263,1423475136279,1423475136295,1423475136330,1423475136332,1423475136474,1423475136475,1423475136524,1423475136541,1423475136558,1423475136575,1423475136591,1423475136607,1423475136623,1423475136639,1423475136655,1423475136672,1423475136707,1423475136862,1423475136862,1423475136918,1423475136935,1423475136952,1423475136968,1423475136984,1423475137012,1423475137124,1423475137125,1423475137148,1423475137165,1423475137182,1423475137198,1423475137214,1423475137233]","coord":"[160,136,160,136,176,136,202,136,224,136,252,133,265,129,271,128,273,128,-1,0,232,147,232,147,228,172,223,207,-1,0,131,248,131,248,137,248,153,246,180,243,211,240,241,237,269,234,291,230,304,229,310,229,314,229,319,231,335,235,-1,0,514,86,514,86,490,104,460,128,442,147,-1,0,483,117,483,117,485,128,486,142,487,157,485,185,482,207,480,231,475,248,469,267,464,276,463,279,-1,0,575,80,575,80,567,91,548,108,534,120,529,128,528,130,527,131,531,129,539,126,554,122,566,117,582,113,599,109,604,108,608,108,609,108,-1,0,560,145,560,145,552,163,543,189,536,211,533,235,533,251,531,272,532,277,532,280,532,282,532,283,-1,0,564,190,564,190,574,190,594,190,602,190,609,190,611,190,-1,0,533,244,533,244,545,244,565,239,589,234,605,230,609,231,-1,0,-1,-1]"}';
//$path = '{"timestamp":"[1423470685445,1423470685447,1423470685472,1423470685489,1423470685506,1423470685522,1423470685539,1423470685555,1423470685575,1423470685634,1423470685635,1423470685653,1423470685670,1423470685686,1423470685702,1423470685718,1423470685735,1423470685751,1423470685768,1423470685784,1423470685801,1423470685817,1423470685833,1423470685850,1423470685867,1423470685883,1423470685900,1423470685915,1423470685949,1423470685964,1423470685981,1423470685998,1423470686014,1423470686031,1423470686048,1423470686063,1423470686080,1423470686096,1423470686112,1423470686129,1423470686145,1423470686162,1423470686178,1423470686195,1423470686211,1423470686228,1423470686243,1423470686261,1423470686277,1423470686294,1423470686310,1423470686326,1423470686343,1423470686360,1423470686376,1423470686392,1423470686421,1423470687043,1423470687044,1423470687097,1423470687115,1423470687130,1423470687148,1423470687164,1423470687180,1423470687196,1423470687213,1423470687230,1423470687270,1423470687271,1423470687327,1423470687344,1423470687361,1423470687377,1423470687394,1423470687420,1423470687500,1423470687501,1423470687541,1423470687558,1423470687575,1423470687591,1423470687607,1423470687624,1423470687640,1423470687656,1423470687672,1423470687688,1423470687706,1423470687722,1423470687738,1423470687770,1423470687787,1423470687804,1423470687820,1423470687836,1423470687865,1423470687968,1423470687969,1423470688030,1423470690081,1423470690083,1423470690135,1423470690150,1423470690168,1423470690183,1423470690197,1423470690276,1423470690276,1423470690314,1423470690331,1423470690347,1423470690364,1423470690381,1423470690396,1423470690413,1423470690429,1423470690446,1423470690479,1423470690496,1423470690512,1423470690528,1423470690544,1423470690560,1423470690577,1423470690594,1423470690610,1423470690626,1423470690643,1423470690660,1423470690677,1423470690692,1423470690708,1423470690725,1423470690757,1423470690774,1423470690791,1423470690807,1423470690823,1423470690839,1423470690856,1423470690872,1423470690890,1423470690905,1423470690922,1423470690938,1423470690954,1423470690971,1423470690987,1423470691004,1423470691021,1423470691038,1423470691055,1423470691661,1423470691661,1423470691709,1423470691726,1423470691743,1423470691759,1423470691775,1423470691791,1423470691808,1423470691825,1423470691842,1423470691857,1423470691874,1423470691890,1423470691906,1423470691923,1423470691939,1423470691956,1423470691972,1423470691989,1423470692006,1423470692104,1423470692105,1423470692136,1423470692153,1423470692170,1423470692186,1423470692202,1423470692219,1423470692235,1423470692251,1423470692267,1423470692284,1423470692316,1423470692334,1423470692349,1423470692366,1423470692382,1423470692399,1423470692415,1423470692432,1423470692458,1423470692547,1423470692547,1423470692619,1423470693236,1423470693237,1423470693284,1423470693315,1423470693920,1423470693921,1423470693941,1423470693958,1423470693975,1423470693991,1423470694008,1423470694024,1423470694056,1423470694073,1423470694089,1423470694106,1423470694123,1423470694139,1423470694155,1423470694172,1423470694188,1423470694220,1423470694237,1423470694254,1423470694270,1423470694286,1423470694303,1423470694319,1423470694335,1423470694352,1423470694368,1423470694385,1423470694401,1423470694417,1423470694434,1423470694451,1423470694467,1423470694483,1423470694499,1423470694516,1423470694532,1423470694549,1423470694566,1423470694582,1423470694598,1423470694624,1423470695419,1423470695420,1423470695468,1423470695486,1423470695501,1423470695518,1423470695535,1423470695551,1423470695567,1423470695583,1423470695600,1423470695616,1423470695633,1423470695650,1423470695666,1423470695682,1423470695699,1423470695715,1423470695731,1423470695747,1423470695764,1423470695781,1423470695797,1423470695814,1423470695830,1423470695846,1423470695862,1423470695879,1423470695911,1423470695929,1423470695944,1423470695961,1423470695978,1423470695994,1423470696010,1423470696026,1423470696042,1423470696059,1423470696075,1423470696125,1423470696159,1423470696174,1423470696191,1423470696207,1423470696224,1423470696241,1423470696256,1423470696273,1423470696289,1423470696305,1423470696322,1423470696339,1423470696363,1423470696930,1423470696931,1423470696995,1423470697012,1423470697028,1423470697044,1423470697060,1423470697086,1423470697166,1423470697167,1423470697207,1423470697224,1423470697241,1423470697258,1423470697283,1423470697419,1423470697420,1423470697454,1423470697471,1423470697488,1423470697504,1423470697520,1423470697537,1423470697552,1423470697569,1423470697585,1423470697601,1423470697618,1423470697635,1423470697651,1423470697667,1423470697684,1423470697700,1423470697717,1423470697733,1423470697750,1423470697766,1423470697783,1423470697799,1423470697815,1423470697842,1423470697969,1423470697969,1423470698056,1423470698548,1423470698548,1423470698602,1423470698620,1423470698643,1423470699179,1423470699179,1423470699226,1423470699244,1423470699261,1423470699276,1423470699293,1423470699309,1423470699341,1423470699358,1423470699374,1423470699391,1423470699408,1423470699423,1423470699440,1423470699457,1423470699473,1423470699489,1423470699506,1423470699526,1423470699638,1423470699639,1423470699702,1423470699720,1423470699735,1423470699752,1423470699769,1423470699785,1423470699921,1423470699922,1423470699965,1423470699982,1423470699999,1423470700015,1423470700031,1423470700048,1423470700064,1423470700080,1423470700096,1423470700113,1423470700130,1423470700146,1423470700263,1423470700264,1423470700325,1423470700798,1423470700798,1423470700851,1423470700877,1423470701308,1423470701308,1423470701360,1423470701379,1423470701567,1423470701568,1423470701590,1423470701607,1423470701624,1423470701641,1423470701657,1423470701673,1423470701689,1423470701716,1423470701871,1423470701872,1423470701918,1423470701935,1423470701952,1423470701968,1423470701984,1423470702000,1423470702033,1423470702050,1423470702067,1423470702083,1423470702099,1423470702115,1423470702132,1423470702148,1423470702165,1423470702181,1423470702197,1423470702214,1423470702231,1423470702246,1423470702263,1423470702279,1423470702296,1423470702312,1423470702329,1423470702346,1423470702361,1423470702378,1423470702394,1423470702411,1423470702427,1423470702444,1423470702460,1423470702477,1423470702493,1423470702509,1423470702526,1423470702542,1423470702558,1423470702575,1423470702591,1423470702612,1423470702702,1423470702702,1423470702739,1423470702757,1423470702772,1423470702791]","coord":"[170,17,170,17,146,44,135,64,123,84,108,103,102,110,98,114,98,116,96,117,100,117,115,110,135,103,153,97,170,89,180,84,185,81,187,81,188,81,181,93,158,118,144,140,133,157,127,167,125,171,126,172,132,168,142,162,162,155,164,155,163,158,149,182,137,206,126,230,117,242,112,248,110,250,115,247,137,221,154,154,151,167,149,187,147,210,144,241,140,270,134,286,131,295,132,298,135,296,157,270,182,234,191,206,-1,0,221,145,221,145,249,129,261,122,271,118,275,117,276,115,-1,0,205,190,205,190,214,190,229,182,256,164,266,156,-1,0,222,72,222,72,224,106,228,142,235,180,243,208,252,231,256,237,260,242,263,244,266,244,273,239,286,222,295,206,298,200,299,196,295,194,286,195,275,202,261,219,244,238,234,250,225,261,219,271,215,272,-1,0,271,72,271,72,-1,0,260,68,260,68,266,86,271,103,-1,0,465,10,465,10,436,30,411,57,402,63,388,73,382,76,380,76,391,70,402,66,413,63,422,64,426,66,428,72,429,89,423,104,417,117,412,131,411,137,-1,0,471,78,471,78,477,87,481,90,496,89,515,77,520,73,-1,0,484,42,484,42,484,66,484,89,487,102,488,116,489,128,491,133,492,138,498,140,510,140,525,123,528,118,-1,0,524,49,524,49,-1,0,527,37,527,37,527,60,-1,0,444,140,444,140,448,148,-1,0,360,186,360,186,388,181,414,175,445,169,483,163,514,156,536,152,549,150,-1,0,449,194,449,194,430,207,407,229,398,237,390,244,384,246,383,246,387,242,398,233,410,223,421,220,426,220,427,225,429,231,427,238,424,247,423,252,423,260,425,263,427,265,428,266,431,264,436,256,441,244,444,235,447,228,448,224,448,223,449,224,449,226,452,231,462,241,470,249,476,260,481,270,485,274,489,277,498,280,508,280,516,280,520,280,524,275,-1,0,520,232,520,232,498,240,483,252,480,255,-1,0,-1,-1]"}';
$path_json = json_decode($path, true);
$coord = $path_json["coord"];
$coord_json = json_decode($coord);
$t_json = json_decode($path_json["timestamp"]);
//var_dump($t_json);
//var_dump("-------------<br/>");
//var_dump($coord_json);
//exit();

reproduce($coord_json, null, null, null);

function reproduce($coords, $timestamps, $width, $height)
{
    $signaturePad = new SignaturePad();

    $stroke_count = 0;

    for ($i = 0; $i < sizeof($coords); $i = $i + 2) {
        $x = $coords[$i];
        $y = $coords[$i + 1];

        //var_dump($x, $y);

        if ($x == -1 && $y == 0) {
            //一笔结束
            $signaturePad->clear();
            $stroke_count++;

            if ($stroke_count == 2) {
                //debug
                break;
                header("Content-type: image/png");
                imagepng($signaturePad->mSignatureBitmap);
                imagedestroy($signaturePad->mSignatureBitmap);
                break;
            }
            continue;
        } else if ($x == -1 && $y == -1) {
            //结束了
            header("Content-type: image/png");
            imagepng($signaturePad->mSignatureBitmap);
            imagedestroy($signaturePad->mSignatureBitmap);
            break;
        }

        $signaturePad->addPoint(new TimedPoint($x, $y, 0));
    }
}